
<#include "/new/main/grid-head.html">
<style>
    .dataTables_length, .dataTables_filter {
        padding: 5px;
    }
    .dataTables_wrapper .dataTables_paginate{
        padding-right: 14px;
    }
    .loading {
        position: relative;
    }

    .dropdown-menu li {
        padding: 0 20px;
    }

    .dropdown-menu li:hover, .dropdown-menu li:hover input, .dropdown-menu li:hover label {
        cursor: pointer;
    }

</style>
<div id="positionsList">
        <div class="col-lg-12">
            <section class="panel">
                <!--列表标题-->
                <header class="panel-heading">
                    岗位信息
                    <div class="tools pull-right">
                        <div class="col-lg-6 tools pull-right">
                            <a class="fa fa-chevron-down" href="javascript:;"></a>
                        </div>
                        <div id="columnSetting" class="col-lg-6" style="cursor: pointer">
                            <a style="position: absolute">
                                <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <i class="fa fa-bars"></i>
                                </a>
                                <ul style="left:-80px" class="dropdown-menu" role="menu">
                                    <li>
                                        <label><input data-column="0" checked type="checkbox"> 编码</label>
                                    </li>
                                    <li>
                                        <label><input data-column="1" checked type="checkbox">岗位名称</label>
                                    </li>
                                    <li>
                                        <label><input type="checkbox" checked data-column="2">所属部门</label>
                                    </li>
                                    <li>
                                        <label><input type="checkbox" checked data-column="3"> 岗位描述</label>
                                    </li>
                                    <li>
                                        <label><input data-column="4" checked type="checkbox">级别</label>
                                    </li>
                                </ul>
                            </a>
                        </div>
                    </div>
                </header>
                <!--搜索条件-->
                <div class="panel-body">
                    <form class="form-horizontal">
                        <!--条件行一-->
                        <div class="form-group">
                            <label for="code" class="control-label col-sm-1">编码</label>
                            <div class="col-sm-2">
                                <input id="code" name="code" class="form-control" type="text" value="">
                            </div>
                            <label for="name" class="control-label col-sm-1">名称</label>
                            <div class="col-sm-2">
                                <input id="name" name="name" class="form-control" type="text" value="">
                            </div>
                            <label for="level" class="control-label col-sm-1">级别</label>
                            <div class="col-sm-2">
                                <select id="level" name="level" class="form-control form-control-placeholder">
                                    <option value="" disabled selected hidden>请选择</option>
                                    <option value="0" style="color: black;">一级</option>
                                    <option value="1" style="color: black;">二级</option>
                                    <option value="2" style="color: black;">三级</option>
                                </select>
                            </div>
                            <label for="description" class="control-label col-sm-1">描述</label>
                            <div class="col-sm-2">
                                <input id="description" name="description" class="form-control" type="text" value="">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-lg-8"></div>
                            <div class="col-lg-4">
                                <div class="col-lg-3">
                                    <button type="button" id="search" class="btn btn-info">查询</button>
                                </div>
                                <div class="col-lg-3">
                                    <button type="button" id="add" class="btn btn-info">新增岗位</button>
                                </div>
                                <div class="col-lg-3 pull-right">
                                    <button class="btn dropdown-toggle" data-toggle="dropdown">更多 <i
                                            class="fa fa-angle-down"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">导出</a></li>
                                        <li><a href="#">打印</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!--列表主体-->
                <table class="table table-striped table-advance table-hover" id="employeeList">
                </table>
                <div class="table-cards"></div>
            </section>
        </div>
</div>

<#include "/new/main/grid-foot.html">
<script>
    $(document).ready(function () {

        var getOrderObj = function (params) {
            if (params.order.length > 0) {
                var columns = params.columns;
                var order = params.order[0];
                return {column: columns[order.column].data, asc: order.dir === 'asc'}
            }
            return null;
        };

        var column = [
            {data: 'code', title: '<i class="fa fa-bullhorn"></i> 编码'},
            {data: 'name', title: '<i class="fa fa-question-circle"></i> 岗位名称'},
            {data: 'departmentId', title: '<i class="fa fa-bookmark"></i> 所属部门'},
            {data: 'description', title: '<i class=" fa fa-edit"></i> 岗位描述'},
            {data: 'level', title: '<i class=" fa fa-edit"></i> 级别'},
            {data: 'updateDate', "visible": false},
        ]

        /*加载列表数据*/
        var dataTable = $('#employeeList').DataTable({
            ajax: {
                url: '/api/positions',
                dataSrc: 'data.records',
                "data": function(d) {
                    d.code = $('#positionsList [name="code"]').val();
                    d.name = $('#positionsList [name="name"]').val();
                    d.description = $('#positionsList [name="description"]').val();
                    d.level = $('#positionsList [name="level"]').val();
                },
                dataFilter: function (json) {
                    var data = JSON.parse(json);
                    data.recordsTotal = data.data.total;
                    data.recordsFiltered = data.data.total;
                    return JSON.stringify(data);
                },
                beforeSend: function () {
                },
                complete: function () {
                },
            },
            "order": [[5, 'desc']],
            columns: column.concat({
                    data: null,
                    orderable: false,
                    title:'<th> 操作</th>',
                    render: function (data, type, row) {
                        return '<button class="btn btn-primary btn-xs edit-btn" data-id='+row.id+'><i class="fa fa-pencil"></i></button>  '
                            + '<button class="btn btn-danger btn-xs delete-btn" data-id='+row.id+'><i class="fa fa-trash-o "></i></button>'
                    }
                }),
            "paging": true,
            "pageLength": 10,
            "bFilter": false,
            "dom": '<"top"i>rb<"bottom"flp><"clear">',
            "oLanguage": {
                "sInfo": "",
                "sInfoEmpty": "",
                "sEmptyTable": "无数据",
                "sLengthMenu": '每页显示 _MENU_ 条记录',
                "oPaginate": {
                    "sPrevious": "上一页",
                    "sNext": "下一页"
                },
            },
            serverSide: true,
            serverParams: function (params) {
                var orderObj = getOrderObj(params);
                params.pageNum = Math.ceil(params.start / params.length) + 1;
                params.pageSize = params.length;
                if (orderObj !== null) {
                    params.column = orderObj.column;
                    params.asc = orderObj.asc
                }
            },
        });

        /*列隐藏显示事件*/
        $('#columnSetting input[type="checkbox"]').on('change', function (e) {
            e.stopPropagation();
            var columnIdx = $(this).data('column');
            dataTable.column(columnIdx).visible($(this).prop('checked'));
        });

        /*列隐藏显示配置阻止冒泡*/
        $('#columnSetting ul.dropdown-menu').on('click', function (e) {
            e.stopPropagation();
        });

        /*搜索事件*/
        $('#search').on('click', function() {
            dataTable.ajax.reload();
        });

        /*新增事件*/
        $('#add').on('click', function() {
            var data={
                code:'position-add',
                name:'新增岗位信息',
                icon:'fa-home',
                url:'/positions/add',

            }
            window.parent.lenosp.tabs.add(data, true);
        });

        /*编辑事件*/
        dataTable.on('click', '.edit-btn', function () {
            var id = $(this).data('id');
            var data = {
                code: 'position-edit',
                name: '编辑岗位信息',
                icon: 'fa-home',
                url: '/positions/update',
                id : id
            };
            window.parent.lenosp.tabs.remove('position-edit');
            window.parent.lenosp.tabs.add(data, true);
        });

        /*删除事件*/
        dataTable.on('click', '.delete-btn', function () {
            var id = $(this).data('id');
            del(id);
        });

        /*删除*/
        var del = function (id) {
            if (confirm("确定要删除吗？")) {
                $.ajax({
                    type: "POST",
                    url: "/api/positions/delete/" + id,
                    success: function (response) {
                        dataTable.ajax.reload();
                    },
                    error: function (error) {
                    }
                });
            } else {
                return false;
            }
        };
    });
</script>