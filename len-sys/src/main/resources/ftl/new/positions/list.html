<style>
    .dataTables_length, .dataTables_filter {
        padding: 5px;
    }
    .dataTables_wrapper .dataTables_paginate{
        padding-right: 14px;
    }
    .loading {
        position: relative;
    }


</style>
<div>
    <div class="row">
        <div class="col-lg-12">
            <section class="panel">
                <header class="panel-heading">
                    岗位信息
                    <span class="tools pull-right">
                        <a class="fa fa-chevron-down" href="javascript:;"></a>
                     </span>
                </header>
                <div class="panel-body">
                    <form class="form-horizontal tasi-form">
                        <!--条件行一-->
                        <div class="row">
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">编码</label>
                                    <div class="col-sm-8">
                                        <input name="code" class="form-control" type="text" value="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">名称</label>
                                    <div class="col-sm-8">
                                        <input name="name" class="form-control" type="text" value="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">描述</label>
                                    <div class="col-sm-8">
                                        <input name="description" class="form-control" type="text" value="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">级别</label>
                                    <div class="col-sm-8">
                                        <input name="level" class="form-control" type="text" value="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                        <!--条件行二-->
                            <div class="col-lg-3">


                            </div>
                            <div class="col-lg-3">


                            </div>
                            <div class="col-lg-3">


                            </div>
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <div class="col-lg-3">
                                        <button type="button"  id="search" class="btn btn-info">查询</button>
                                    </div>
                                    <div class="col-lg-4">
                                        <button type="button" id="add" class="btn btn-info">新增岗位</button>
                                    </div>
                                    <div class="col-lg-5">
                                        <button class="btn dropdown-toggle pull-right" data-toggle="dropdown">更多操作 <i
                                                class="fa fa-angle-down"></i>
                                        </button>
                                        <ul class="dropdown-menu pull-right">
                                            <li><a href="#">导出</a></li>
                                            <li><a href="#">打印</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div id="paginationWrapper" style="padding-right: 15px"></div>
                <table class="table table-striped table-advance table-hover" id="employeeList">
                    <thead>
                    <tr>
                        <th><i class="fa fa-bullhorn"></i> 编码</th>
                        <th><i class="fa fa-question-circle"></i> 岗位名称</th>
                        <th><i class="fa fa-bookmark"></i> 所属部门</th>
                        <th><i class=" fa fa-edit"></i> 岗位描述</th>
                        <th><i class=" fa fa-edit"></i> 级别</th>
                        <th><i class=" fa fa-edit"></i> 操作</th>
                    </tr>
                    </thead>
                    <tbody>


                    </tbody>
                </table>
            </section>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {

        var getOrderObj = function (params) {
            if (params.order.length > 0) {
                var columns = params.columns;
                var order = params.order[0];
                return {column: columns[order.column].column, asc: order.dir === 'asc'}
            }
            return null;
        };

        var dataTable = $('#employeeList').DataTable({
            ajax: {
                url: '/api/positions',
                dataSrc: 'data.records',
                "data": function(d) {
                    d.code = $('[name="code"]').val();
                    d.name = $('[name="name"]').val();
                    d.description = $('[name="description"]').val();
                    d.devel = $('[name="devel"]').val();
                },
                dataFilter: function (json) {
                    var data = JSON.parse(json);
                    data.recordsTotal = data.data.total;
                    data.recordsFiltered = data.data.total;
                    return JSON.stringify(data);
                },
                beforeSend: function () {
                },
                complete: function () {
                },
            },
            columns: [
                {data: 'code', column: 'code', orderable: true},
                {data: 'name', column: 'name'},
                {data: 'departmentId', column: "department_id"},
                {data: 'description', column: 'description'},
                {data: 'level', column: 'level'},
                {
                    data: null,
                    orderable: false,
                    render: function (data, type, row) {
                        return `<button class="btn btn-danger btn-xs delete-btn" data-id="${row.id}"><i class="fa fa-trash-o "></i></button>`
                    }
                }
            ],
            "paging": true,
            "pageLength": 10,
            "bFilter": false,
            "dom": '<"top"i>rb<"bottom"flp><"clear">',
            "oLanguage": {
                "sInfo": "",
                "sLengthMenu": '每页显示 _MENU_ 条记录',
                "oPaginate": {
                    "sPrevious": "上一页",
                    "sNext": "下一页"
                },
            },
            serverSide: true,
            serverParams: function (params) {
                var orderObj = getOrderObj(params);
                params.pageNum = Math.ceil(params.start / params.length) + 1;
                params.pageSize = params.length;
                if (orderObj !== null) {
                    params.column = orderObj.column;
                    params.asc = orderObj.asc
                }
            },
        });

        $('#search').on('click', function() {
            dataTable.ajax.reload();
        });

        $('#add').on('click', function() {
            var data={
                code:'position-add',
                name:'新增岗位信息',
                icon:'fa-home',
                url:'/positions/add',

            }
            lenosp.tabs.add(data, true);
        });

        dataTable.on('click', '.delete-btn', function () {
            var id = $(this).data('id');
            del(id);
        });

        var del = function (id) {
            if (confirm("确定要删除吗？")) {
                $.ajax({
                    type: "POST",
                    url: "api/positions/delete/" + id,
                    success: function (response) {
                        dataTable.ajax.reload();
                    },
                    error: function (error) {
                    }
                });
            } else {
                return false;
            }
        }
    });
</script>


